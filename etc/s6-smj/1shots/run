#!/bin/execlineb -P
# start all system 1shots

fdmove -c 2 1
foreground { s6-echo "\nstarting 1shot up scripts" }

execline-cd data
elglob -v -0 -s ups */

foreground {
	forx -E -p up { ${ups} }
	foreground { s6-echo "starting '${up}'" }
	execline-cd ${up}
	foreground {
		if { eltest -e waitup.done }
		mv waitup.done waitup
	}
	redirfd -a 1 log
	fdmove -c 2 1
	foreground { s6-echo "\nstarting '${up}'" }
	./up
}

foreground { s6-echo "all 1shot up scripts completed" }
#signal completion
foreground { fdmove 1 3	s6-echo }
fdclose 3
s6-pause
